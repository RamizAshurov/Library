<html>
    <head>
        <style>
        </style>
    </head>
    <body>
        <button>New div</button>
        <script>
            document.getElementsByTagName("button")[0].onclick = function () {
                // if (document.getElementsByTagName("div").length) return
                document.body.insertBefore(document.createElement("div"),document.body.children[1])
                var div = document.getElementsByTagName("div")[0]
                div.ondragstart = function () {return false}
                div.style.width = 100 + 100*Math.random() + "px"
                div.style.height = 100 + 100*Math.random() + "px"
                div.style.backgroundColor = getColor()
                div.style.position = "absolute";
                div.style.top = Math.random()* window.innerHeight
                div.style.left = Math.random()*window.innerWidth
                div.onmousedown = function (event) {
                    var coords = getCoords(div);
                    var shiftX = event.pageX - coords.left;
                    var shiftY = event.pageY - coords.top;
                    document.onmousemove = function shift (e) {
                        div.style.left = e.pageX - shiftX + "px"
                        div.style.top = e.pageY - shiftY+"px"
                    }
                }
                div.onmouseup = function (event) {
                    document.onmousemove = null
                }
                function getCoords(elem) {
                    var box = elem.getBoundingClientRect();
                    return {
                        top: box.top + pageYOffset,
                        left: box.left + pageXOffset
                    }
                }
                function getColor() {
                    var color = "0123456789ABCDEF",
                        str = "#";
                    for (var i = 0; i < 6; i++) {
                        str += color[Math.floor((Math.random()*16))]
                    }
                    return str
                }
            }
        </script>
    </body>
</html>